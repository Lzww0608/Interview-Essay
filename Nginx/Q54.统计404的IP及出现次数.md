# Q54.统计404的IP及出现次数

要分析Nginx日志并统计访问状态码为404的IP地址及其出现次数，可以使用Unix/Linux命令行工具组合，主要是`awk`，来处理Nginx的访问日志文件。这种分析有助于识别可能的错误链接、恶意扫描或配置问题。以下是一个示例命令，用于实现此分析：

#### 步骤

1. **使用awk筛选状态码为404的记录**：从Nginx日志中筛选出HTTP状态码为404的日志条目。
2. **统计每个IP的出现次数**：对筛选结果中的IP地址进行计数。
3. **输出每个IP及其出现次数**：最后，输出每个IP地址及其对应的404状态码出现次数。

#### 示例命令

假设你的Nginx访问日志文件位于`/var/log/nginx/access.log`，可以运行以下命令：

```sh
awk '9 == 404 {print1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr
```

#### 命令解释

- `awk '9 == 404 {print1}' /var/log/nginx/access.log`：这个`awk`命令检查每条日志记录的第9个字段（假设为HTTP状态码）是否等于404，如果是，则打印出该记录的第一个字段（假设为IP地址）。
- `sort`：将提取的IP地址排序，以便`uniq -c`可以正确统计。
- `uniq -c`：统计并输出每个唯一IP地址的出现次数。
- `sort -nr`：将结果按出现次数降序排序，这样最频繁出现404错误的IP地址会排在最前面。

#### 注意事项

- 确保根据你的Nginx日志格式调整`awk`命令中的字段位置。例如，如果状态码或IP地址不是第9个或第1个字段，你需要相应地调整字段编号。
- 对于大型日志文件，该命令可能需要一些时间来执行。确保有足够的时间和资源来处理分析。

