# Q26.未定义服务器阻止请求

在Nginx中，可以通过设置一个默认的`server`块来处理未定义服务器名称（也就是未匹配到已配置的`server_name`）的请求。通常，这个默认的`server`块会配置为返回404错误或者直接拒绝请求，以此来阻止处理对未定义服务器名称的请求。这种做法可以增加服务器的安全性，防止未授权的域名访问你的服务器资源。

以下是一个示例配置，展示了如何设置默认`server`块来拒绝或处理这类请求：

#### 配置默认的`server`块

```nginx
http {
    # 定义默认的 server 块
    server {
        listen 80 default_server; # 或 listen [::]:80 default_server; 对于IPv6
        server_name _; # 使用下划线作为占位符，表示匹配任何服务器名称

        # 返回404或者直接拒绝请求
        return 404; # 或使用 return 444; 来直接关闭连接
    }

    # 定义其他正常的 server 块
    server {
        listen 80;
        server_name example.com;

        # 正常的配置...
    }

    # 更多的 server 块配置...
}
```

在这个配置中，`listen 80 default_server;`指令使得这个`server`块成为默认的服务器块，用于处理所有未明确匹配到`server_name`的请求。`server_name _;`是一个通配符设置，表示匹配任何服务器名称。这个配置中，所有对未定义服务器名称的请求都会收到一个404错误作为响应。

#### 使用444状态码直接关闭连接

Nginx特有的444状态码可以用来直接关闭连接，而不返回任何响应给客户端。这可以在某些情况下用来提高安全性，防止恶意请求：

```nginx
return 444;
```

#### 注意

- 确保你的默认`server`块是配置文件中第一个出现的`listen`指令对应的端口上的`default_server`，这样Nginx才会将其作为默认服务器处理所有未定义服务器名称的请求。
- 修改配置后，记得使用`nginx -t`测试配置文件的正确性，并使用`nginx -s reload`命令重载Nginx配置使更改生效。

通过这种方式，Nginx可以有效地防止未授权或未预期的域名访问你的Web应用，从而提高服务器的安全性。