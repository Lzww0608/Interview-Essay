# Q121.迭代器

C++ 标准库定义了 5 种**迭代器类别 (Iterator Categories)**。这些类别根据迭代器支持的操作（移动、读、写能力）进行了划分，它们形成了一个**能力递增**的层次结构。算法会根据它们需要的最低迭代器能力来指定可以接受的迭代器类别。

这 5 种迭代器类别分别是：

1. **输入迭代器 (Input Iterator):**

   - **能力:** 只能向前移动 (`++`)，只能读取 (`*`，只读) 一次。它提供对序列的**单趟 (Single-pass)** 顺序只读访问。一旦递增，之前的值可能就无法访问了。
   - **支持操作:** `*` (读取), `->`, `++` (前置和后置), `==`, `!=`。
   - **典型例子:** 从输入流读取数据 (`std::istream_iterator`)，用于只需要遍历一次读取数据的算法（如 `std::find`, `std::accumulate`）。

2. **输出迭代器 (Output Iterator):**

   - **能力:** 只能向前移动 (`++`)，只能写入 (`* = value`) 一次。它提供对序列的**单趟 (Single-pass)** 顺序只写访问。
   - **支持操作:** `*it = value` (写入), `++` (前置和后置)。注意：对输出迭代器解引用 (`*it`) 后立即赋值，且通常不期望能读回刚写入的值。`==`, `!=` 的支持是有限的（通常只用于判断是否到达末尾）。
   - **典型例子:** 向输出流写入数据 (`std::ostream_iterator`), 插入迭代器 (`std::back_inserter`, `std::front_inserter`, `std::inserter`)，用于只需要遍历一次写入数据的算法（如 `std::copy` 的输出）。

3. **前向迭代器 (Forward Iterator):**

   - **能力:** 可以向前移动 (`++`)，可以多次读取 (`*`) 或写入 (`* = value`, 如果不是 const 迭代器)。它提供对序列的**多趟 (Multi-pass)** 顺序读写访问。你可以保存一个前向迭代器的副本，稍后用它从相同位置重新开始遍历。
   - **支持操作:** 包含所有输入迭代器的操作（`*` 读, `->`, `++`, `==`, `!=`），并且如果可写，则支持输出迭代器的写操作 (`* = value`)。关键在于**可以多次解引用同一个迭代器位置获取相同的值**（只要序列未改变）。
   - **典型例子:** `std::forward_list` 的迭代器，大部分不需要反向遍历的算法（如 `std::replace`）的最低要求。

4. **双向迭代器 (Bidirectional Iterator):**

   - **能力:** 具备前向迭代器的所有能力，并且增加了**向后移动 (--)** 的能力。
   - **支持操作:** 包含所有前向迭代器的操作，并增加了 `--` (前置和后置) 操作。
   - **典型例子:** `std::list`, `std::set`, `std::map`, `std::unordered_set`, `std::unordered_map` 的迭代器。用于需要双向遍历的算法（如 `std::reverse`）。

5. **随机访问迭代器 (Random Access Iterator):**

   - **能力:** 具备双向迭代器的所有能力，并且增加了**常数时间内的任意步长移动**和**访问**的能力（像指针一样）。

   - 支持操作:

     包含所有双向迭代器的操作，并增加了：

     - 算术运算：`it + n`, `n + it`, `it - n`
     - 复合赋值：`it += n`, `it -= n`
     - 下标访问：`it[n]` (等价于 `*(it + n)`)
     - 比较：`<`, `>`, `<=`, `>=`
     - 两个迭代器相减得到距离：`it2 - it1`

   - **典型例子:** `std::vector`, `std::deque`, `std::array`, `std::string` 的迭代器，以及原始的 C 风格指针。用于需要高效随机访问的算法（如 `std::sort`, `std::binary_search`）。

**总结:**

这个分类形成了一个层次结构：

- 随机访问迭代器 **包含** 双向迭代器的所有能力。
- 双向迭代器 **包含** 前向迭代器的所有能力。
- 前向迭代器 **包含** 输入迭代器的所有能力（并且是多趟的，如果可写也支持输出迭代器的写）。
- 输入迭代器和输出迭代器是基础，主要特点是单趟性。

了解这些类别有助于理解 C++ 标准库算法对容器的要求，以及为什么某些算法不能用于某些容器（例如，`std::sort` 要求随机访问迭代器，所以不能直接用于 `std::list`）。