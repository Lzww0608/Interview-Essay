# Q109.MySQL索引优化

在MySQL中，`ORDER BY`和`GROUP BY`在某些情况下可以使用索引来优化查询性能，但并不是所有情况都能使用索引。以下是使用索引的条件和不使用索引的情况：

### `ORDER BY` 使用索引的条件

1. **单列排序**：如果 `ORDER BY` 的列上有索引，MySQL 可能会使用该索引加速排序。
2. **符合最左前缀规则**：当 `ORDER BY` 的列符合联合索引的最左前缀规则时，MySQL 可以使用联合索引。
3. **排序方式与索引一致**：如果 `ORDER BY` 的排序顺序（ASC 或 DESC）和索引定义的顺序一致，MySQL 会直接使用索引而不需要额外排序。
4. **覆盖索引**：当查询的列都包含在索引中时，MySQL 可以直接使用索引避免回表。

#### 不使用索引的情况

1. **多列排序且不符合联合索引**：如果 `ORDER BY` 中包含的多列不符合联合索引的最左前缀规则，则无法利用索引。
2. **排序方向不一致**：当 `ORDER BY` 中的多个列排序方向（ASC 或 DESC）不同时，索引无法优化排序。
3. **含有函数或表达式**：如果在 `ORDER BY` 中使用了函数或表达式，MySQL 无法使用索引。

### `GROUP BY` 使用索引的条件

1. **单列分组**：当 `GROUP BY` 的列上有索引时，MySQL 可以使用该索引加快分组操作。
2. **联合索引的最左前缀规则**：如果 `GROUP BY` 的列是联合索引的最左前缀，MySQL 可以利用该索引。
3. **覆盖索引**：如果查询的列包含在 `GROUP BY` 列的索引中，MySQL 可以使用覆盖索引避免回表。

#### 不使用索引的情况

1. **多列分组但不符合最左前缀**：当 `GROUP BY` 涉及多列，且这些列不是联合索引的最左前缀时，MySQL 无法利用索引。
2. **使用函数或表达式**：如果 `GROUP BY` 中包含了函数或表达式，MySQL 也无法使用索引。
3. **含有 HAVING 子句**：如果 `GROUP BY` 后面紧接着一个 `HAVING` 子句，且过滤条件没有包含在索引列中，也会影响索引的使用。

### 示例

```sql
-- ORDER BY 使用索引的例子
SELECT * FROM users
ORDER BY age ASC; -- 如果age字段有索引

-- GROUP BY 使用索引的例子
SELECT department, COUNT(*) FROM employees
GROUP BY department; -- 如果department字段有索引
```

总结来说，`ORDER BY` 和 `GROUP BY` 是否会用到索引，取决于查询条件是否符合最左前缀、排序方向、是否包含函数或表达式等条件。