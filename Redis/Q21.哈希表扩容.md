# Q21.哈希表扩容

Redis的哈希表扩容是指在哈希表需要增加更多的槽位（bucket）来存储元素时进行的一种扩展机制。当哈希表中的元素数量增加到一定阈值时，Redis会自动触发哈希表的扩容操作。

哈希表扩容的过程如下：

1. **新建更大的空白哈希表**：Redis会创建一个更大的空白哈希表，其槽数量通常是当前哈希表槽数量的两倍。
2. **搬移数据**：Redis逐个遍历原哈希表中的每个槽位，将非空的槽位中的元素重新计算哈希值，然后放入新的哈希表的对应槽位中。这个过程称为rehash。
3. **渐进式地迁移数据**：为了避免一次性大量数据的搬移导致系统的延迟，Redis采用渐进式的方式进行数据迁移。每次执行rehash操作时，Redis只处理一小部分槽位，并渐进地将数据从原哈希表迁移到新哈希表中。
4. **更新指针和释放内存**：当新哈希表中的rehash操作完成后，Redis会将指向原哈希表的指针更新为新哈希表，并释放原哈希表所占用的内存。

需要注意的是，在哈希表进行扩容期间，Redis会同时维护原哈希表和新哈希表，保证数据的正常访问。在数据迁移过程中，读取操作会同时访问两个哈希表，写入操作会先写入新哈希表，并同时更新两个哈希表，以确保数据的一致性。

哈希表扩容是Redis动态调整内存空间的关键机制之一，它通过增加槽位来适应数据的增长，保证了哈希表的性能和容量。同时，由于采用了渐进式的迁移策略，在数据量较大情况下也能较好地控制系统的稳定性和延迟