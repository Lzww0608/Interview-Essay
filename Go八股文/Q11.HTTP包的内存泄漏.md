# Q11. HTTP包的内存泄漏

`Go`语言的`net/http`包适用于处理HTTP请求和相应的库，但如果使用不正确，可能会导致内存泄漏。以下是一些常见的可能引起内存泄漏的场景及其解决办法：

1. **未关闭Response.Body**：当你使用`http.Get`或者`http.Post`等方法发送请求时，你需要在完成读取响应体后关闭她。否则链接可能无法复用，导致内存泄漏。

   ```go
   resp, err := http.Get("http://baidu.com")
   if err != nil {
       // handle error
   }
   defer resp.Body.Close()
   ```

2. **长时间运行的Handler**：如果你的HTTP HANDLER需要很长时间才能完成，例如因为需要进行复杂的计算或者等待其他资源，这可能会导致大量的协程被阻塞，消耗大量的内存。因此，这种情况下可以考虑使用一些异步处理的方式，比如将任务放入队列，或者使用`context`来设置超时。

+ **未处理的长连接**：如果服务器需要处理长连接(例如`WebSocket`或者`HTTP/2`)，那么就需要确保在连接不再需要的时候能够正确地关闭它。否则，这些连接可能会持续消耗内存。
+ **大量的中间件**：如果使用了大量的中间件，这可能会导致每个请求需要大量的内存，所以应该尽量减少中间件的使用或者使用内存效率更高的中间件。

总之，正确使用`net/http`包并且注意处理所有的资源，可以避免大部分的内存泄漏问题。