# Q30. 如何测量函数执行时间

```go
package main

import (
	"fmt"
	"testing"
	"time"
)

// trackTime is a utility function that calculates and prints the elapsed time since 'pre'.
// It takes a timestamp 'pre' as input and returns the elapsed duration.
func trackTime(pre time.Time) time.Duration {
	elapsed := time.Since(pre) // Calculate elapsed time since the given time 'pre'.
	fmt.Println("elapsed:", elapsed) // Print the elapsed time.

	return elapsed // Return the elapsed duration.
}

// trackTimeFunc is a utility function that returns a closure to track elapsed time.
// When the returned function is called, it prints the time elapsed since the original call to trackTimeFunc.
func trackTimeFunc() func() {
	pre := time.Now() // Record the current time.
	return func() {
		elapsed := time.Since(pre) // Calculate elapsed time since 'pre'.
		fmt.Println("elapsed:", elapsed) // Print the elapsed time.
	}
}

// testTrackTime demonstrates the usage of the 'trackTime' function.
// It uses a 'defer' statement to ensure that the time-tracking logic is executed after the function completes.
func testTrackTime(t *testing.T) {
	defer trackTime(time.Now()) // Defer the call to 'trackTime' to measure the duration of the entire function execution.

	time.Sleep(500 * time.Millisecond) // Simulate some work by sleeping for 500 milliseconds.
}

// testTrackTimeFunc demonstrates the usage of the 'trackTimeFunc' function.
// It uses a deferred function to measure elapsed time when the function completes.
func testTrackTimeFunc(t *testing.T) {
	defer trackTimeFunc()() // Defer the closure returned by 'trackTimeFunc' to measure the function's duration.

	time.Sleep(500 * time.Millisecond) // Simulate some work by sleeping for 500 milliseconds.
}

// main is the entry point of the program, which calls the test functions.
// It passes a pointer to 'testing.T' just to match the function signature, even though 'testing.T' is not used here.
func main() {
	testTrackTime(&testing.T{}) // Call 'testTrackTime' function.
	time.Sleep(100 * time.Millisecond) // Sleep for 100 milliseconds before running the next test.
	testTrackTimeFunc(&testing.T{}) // Call 'testTrackTimeFunc' function.
}
```

The comments are generated by ChatGPT 4-o with canvas.