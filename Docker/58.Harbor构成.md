# 58.Harbor构成

Harbor是一个企业级的开源Docker镜像仓库，它由多个核心组件构成。主要构成包括Core组件、Registry组件、Web UI、数据库、身份管理、镜像扫描器等。这些组件协同工作，提供强大的镜像管理、用户认证、安全扫描等功能。

### 详细讲解与拓展

1. Core 组件：
   - Core是Harbor的核心部分，负责整个Harbor系统的管理和协调。它控制着其他组件的配置、任务调度、任务执行等功能。它通过Web UI和API与用户交互，处理项目、仓库、镜像等资源的管理。
   - Core负责与数据库交互，存储Harbor的配置信息和元数据，如用户信息、项目、镜像标签等。
2. Docker Registry：
   - Harbor基于Docker Registry构建，Registry是Harbor的核心镜像存储组件，负责存储和管理Docker镜像。
   - 它提供了对镜像的增删改查（push/pull）操作。当用户上传或下载镜像时，Registry处理这些请求，并确保镜像的存储和访问。
   - Docker Registry实现了镜像的存储功能，同时支持镜像标签管理、版本控制等。
3. Web UI：
   - Web UI是Harbor的用户界面，用户可以通过它方便地管理镜像、项目和用户权限等。
   - Web UI提供了直观的界面，展示镜像的上传、下载、复制等操作的状态。管理员可以通过UI配置项目、设置权限，监控镜像的安全性和健康状态。
4. 数据库：
   - Harbor使用数据库来存储系统的元数据，包括用户信息、项目配置信息、镜像仓库信息、镜像标签等。
   - 通常，Harbor使用PostgreSQL作为数据库系统，提供持久化存储和高效的查询能力。数据库确保了Harbor在重启后能够恢复数据。
5. 身份管理与认证服务：
   - Harbor提供了身份管理和认证服务，负责用户的身份验证和权限控制。
   - 它支持多种认证方式，如LDAP、OIDC等，方便企业与现有的身份管理系统集成。通过身份管理，Harbor能够控制哪些用户可以访问、推送、拉取镜像，增强了系统的安全性。
6. 镜像扫描器（Clair）：
   - Harbor集成了镜像漏洞扫描工具Clair，扫描镜像中的已知安全漏洞。
   - 当镜像被上传到Harbor时，系统会自动对镜像进行安全扫描，检测其是否存在安全漏洞。扫描结果会提供漏洞的详细信息和修复建议，帮助用户确保镜像的安全性。
7. 日志与审计服务：
   - Harbor提供了日志记录和审计功能，能够跟踪用户对镜像的操作，如上传、下载、删除等。
   - 日志信息可以用于审计和安全监控，帮助管理员跟踪用户行为，发现潜在的安全问题。
8. 镜像复制服务：
   - Harbor支持镜像的跨服务器复制，用户可以将镜像从一个Harbor实例复制到另一个实例，方便镜像的多地点分发。
   - 复制服务支持镜像的自动同步和手动触发，确保镜像在不同数据中心或地域之间的一致性。
9. 缓存和存储：
   - Harbor支持不同的存储后端，如本地文件系统、Amazon S3、NFS等。不同的存储后端可以根据企业的需求选择，确保镜像存储的可靠性和扩展性。
   - 它还通过缓存机制提高镜像拉取的效率，减少网络带宽的消耗。

**总结**：Harbor由多个关键组件组成，主要包括Core组件、Docker Registry、Web UI、数据库、身份管理、镜像扫描器等。这些组件协同工作，为用户提供高效、安全的Docker镜像管理平台，支持多项目管理、权限控制、镜像扫描、镜像复制等功能。