# Q16.降级熔断限流

**降级、熔断和限流**是微服务架构中常用的三种机制，用于提升系统的稳定性和可用性。它们分别应对不同的系统问题：

1. **降级**：当某个服务出现问题时，系统会自动启用降级策略，提供一个简化或替代的方案，保证系统的部分功能可用。例如，当支付服务不可用时，系统可以暂时关闭支付功能或提供备用支付方式。
2. **熔断**：熔断机制用于防止故障蔓延。当某个服务出现持续故障时，熔断器会自动“打开”，阻止进一步的请求流向该服务，避免系统整体崩溃。熔断器会等服务恢复健康后，再恢复正常流量。
3. **限流**：限流是通过对系统请求进行限制，避免短时间内过多的请求涌入系统，导致服务过载。常见的限流策略有令牌桶、漏斗算法等，通常用于高并发场景中，保证系统稳定运行。

### 详细讲解与拓展

#### 1. **降级**

降级是指在某个服务不可用时，系统会提供一个简化的功能或者备用方案，确保系统的可用性和稳定性。例如，某个服务的计算逻辑复杂，如果该服务出现问题，系统可以选择返回一个默认值或者一个简化版本的数据。

**示例**：电商网站的推荐系统可能在某些时段或高负载下不可用，但系统仍然能提供基本的商品浏览和搜索功能。这是通过降级策略，将推荐服务关闭或替代为静态数据来保障基本功能的可用性。

#### 2. **熔断**

熔断是防止服务故障扩展的策略。当一个服务持续不可用时，熔断机制会自动触发，停止将请求发送到故障服务，避免请求积压导致系统更严重的崩溃。熔断器通常有三种状态：关闭、打开和半开。

**示例**：当支付服务连续失败（比如连续5次请求超时）时，熔断器会进入打开状态，停止对支付服务的请求。熔断器会定期尝试恢复服务，直到服务稳定后再恢复正常请求。

#### 3. **限流**

限流是控制请求量的机制，通过限制单位时间内的请求数量来保护系统避免过载。限流有不同的算法和策略，例如**令牌桶算法**和**漏斗算法**，它们能够根据不同的负载需求平滑地控制请求流量。

**示例**：如果一个电商网站的订单处理服务面临高并发访问，可以通过限流策略限制每秒最多处理100个订单请求。如果请求超出限制，后续的请求会被拒绝或排队等待，从而防止系统因请求过多而崩溃。

### 总结

- **降级**是当服务不可用时，采取简化或替代方案保证部分功能可用；
- **熔断**是防止故障蔓延的机制，当服务出现持续失败时，自动停止请求并进入保护状态；
- **限流**是控制系统请求流量的机制，防止高并发请求导致系统过载。